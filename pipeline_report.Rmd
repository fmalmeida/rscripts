---
title: "Pipeline Report"
author: "Felipe Marques de Almeida <falmeida@aluno.unb.br>"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    theme: readable
    toc: true
    df_print: paged
params:
  prefix: na
  fasta: na
  gff: na
  gff_dir: na
  gbk: na
  command: nextflow run pipeline -c config
  config: na
  blast_dir: na 
  is_resistance: FALSE
  resistance_gff: na
  resistance_summary: na
  is_CARD: FALSE
  card_summary: na
  is_Resfinder: FALSE
  is_ICEberg: FALSE
  ice_summary: na
  ice_gff: na
  is_PHAST: FALSE
  is_VFDB: FALSE
  is_Victors: FALSE 
---
```{r setup, echo=FALSE}
library(magrittr)

# Prefix
prefix <- params$prefix
# Fasta file name
fasta <- params$fasta
# Gff filename
gff <- params$gff
# Gff directory name
gff_dir <- params$gff_dir
# Genbank filename
gbk <- params$gbk
# Load of configuration file
config <- params$config
# Nextflow command used
command <- params$command
# Blast directory name
blast_dir <- params$blast_dir
# Was some resistance database used?
is_resistance <- params$is_resistance
## Get resistance gff filepath
resistance_gff <- params$resistance_gff
## Get resistance summary path
resistance_summary <- params$resistance_summary
# Get CARD variables
## Was CARD executed?
is_CARD <- params$is_CARD
## CARD summary table path
card_summary <- params$card_summary
# Get Resfinder variables
## Was Resfinder executed?
is_Resfinder <- params$is_Resfinder
# Get ICEberg variables
## Was ICEberg executed?
is_ICEberg <- params$is_ICEberg
## ICEberg summary table path
ice_summary <- params$ice_summary
## ICEberg gff filepath
ice_gff <- params$ice_gff
# Get PHAST variables
## Was PHAST executed?
is_PHAST <- params$is_PHAST
# Get VFDB variables
## Was VFDB executed?
is_VFDB <- params$is_VFDB
# Get Victors variables
## Was Victors executed?
is_Victors <- params$is_Victors
```

# Introduction

This pipeline was automatically produced via our [annotation pipeline](https://github.com/fmalmeida/bioinfo/tree/master/pipelines/bac_annotation) (`give a name`) and it contains the results from the annotation of the ``r fasta`` FASTA file.

Any doubts, please contat me at <falmeida@aluno.unb.br>.

## Execution

Command line: 

The pipeline was successfully executed with the following parameters:

* Fasta: ``r fasta``
* Output prefix: ``r prefix``
* Configuration file:

````groovy
```{r comment='', echo=FALSE, highlight=TRUE}
cat(readLines(config), sep = '\n')
```
````

## Report Content

This report contains a summary of the pipeline's most important results, which are:

* The final GFF and Genbank File;
* BLAST storage directory;
* Summary tables of ices, virulence, prophage and resistance genes;
* JBROWSE genome browser;
* And an explanation about how to extract data from the sql database produced.

> Since the execution of additional blasts is optional, this report may or not contain a section
> for some databases based on its execution.

### Final GFF

* GFF filepath: ``r gff`` ;
* GFF dir: `` r gff_dir`` ;
    * In this directory are stored the final gff file and the subseted gffs (e.g. _prefix_\_**resistance**.gff)
* Genbank file filepath: ``r gbk``.
* Complete GFF file summarization:

```{r Gff file, comment="", eval=TRUE, echo=FALSE}
gffFile <- ballgown::gffRead(params$gff)
gffFile
```

### Additional BLASTS executed

If executed, the blast outputs will all be stored at ``r blast_dir`` directory.

* Was the additional database used to BLAST against?
    * CARD database: ``r is_CARD``
    * Resfinder database: ``r is_Resfinder``
    * ICEberg database: ``r is_ICEberg``
    * PHAST database: ``r is_PHAST``
    * Victors database: ``r is_Victors``
    * VFDB database: ``r is_VFDB``

### Summary tables

This section is based on the blast search above. If no additional database were searched then no summary table were produced.

Therefore, this section can appear blank or it can contain the summary tables produced.

```{r, ICEberg_conditional_block, echo=FALSE, results='asis', eval=is_ICEberg, child='ices.Rmd'}
```

```{r, resistance_conditional_block, echo=FALSE, results='asis', eval=is_resistance, child='resistance.Rmd'}
```